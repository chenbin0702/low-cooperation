import{_ as fe,r as y,a as q,o as ce,c as u,n as be,d as v,e as V,f as e,w as t,E as F,F as U,p as N,i as d,g as D,q as ve,h as ge,t as g,j as E,l as _e}from"./index-bbf05c48.js";const ye={class:"customer-follow-up"},Ve={class:"card-header"},we={class:"pagination"},ke={class:"mt-2"},Ue={class:"dialog-footer"},De={key:0,class:"mt-4"},Ce={__name:"CustomerFollowUp",setup(xe){const $=[{label:"电话",value:"phone"},{label:"邮件",value:"email"},{label:"面谈",value:"face"},{label:"视频会议",value:"video"}],X=[{label:"无人机A型",value:"drone-a"},{label:"无人机B型",value:"drone-b"},{label:"航拍服务",value:"aerial-photo"},{label:"测绘服务",value:"mapping"},{label:"植保服务",value:"plant-protection"}],Z=[{label:"示例客户1",value:"customer1"},{label:"示例客户2",value:"customer2"}],C=y(!1),z=y(!1),x=y(!1),S=y(!1),T=y("add"),M=y(null),s=y({}),m=q({customerName:"",type:"",dateRange:[]}),_=q({currentPage:1,pageSize:10,total:0}),o=q({customerName:"",date:"",type:"",content:"",feedback:"",intention:0,nextFollowUpDate:"",isDeal:!1,dealInfo:{products:[],usageFeedback:"",maintenanceRecords:[]}}),j=y([]),ee={customerName:[{required:!0,message:"请选择客户",trigger:"change"}],date:[{required:!0,message:"请选择沟通时间",trigger:"change"}],type:[{required:!0,message:"请选择沟通方式",trigger:"change"}],content:[{required:!0,message:"请输入沟通内容",trigger:"blur"}],nextFollowUpDate:[{required:!0,message:"请选择下次跟进时间",trigger:"change"}]},O=n=>({phone:"",email:"success",face:"warning",video:"info"})[n]||"",Y=()=>{k()},le=()=>{Object.keys(m).forEach(n=>{m[n]=""}),m.dateRange=[],Y()},ae=n=>{_.pageSize=n,k()},te=n=>{_.currentPage=n,k()},L=(n,l=null)=>{T.value=n,x.value=!0,n==="edit"&&l?Object.assign(o,l):(Object.keys(o).forEach(f=>{f==="dealInfo"?o[f]={products:[],usageFeedback:"",maintenanceRecords:[]}:o[f]=""}),o.intention=0,o.isDeal=!1)},oe=n=>{s.value={...n},S.value=!0},ne=n=>{n||(o.dealInfo={products:[],usageFeedback:"",maintenanceRecords:[]})},de=()=>{o.dealInfo.maintenanceRecords.push({date:"",issue:"",solution:""})},ue=n=>{o.dealInfo.maintenanceRecords.splice(n,1)},se=async()=>{if(M.value)try{await M.value.validate(),z.value=!0,await new Promise(n=>setTimeout(n,1e3)),F.success(T.value==="add"?"添加成功":"更新成功"),x.value=!1,k()}catch{F.error("表单验证失败，请检查必填项")}finally{z.value=!1}},re=n=>{_e.confirm("确定要删除该跟进记录吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{C.value=!0;try{await new Promise(l=>setTimeout(l,1e3)),F.success("删除成功"),k()}catch{F.error("删除失败")}finally{C.value=!1}})},k=async()=>{C.value=!0;try{await new Promise(n=>setTimeout(n,1e3)),j.value=[{id:1,customerName:"示例客户1",date:"2024-01-15 14:30:00",type:"phone",content:"讨论产品需求和预算情况",feedback:"对产品比较感兴趣，需要进一步了解技术细节",intention:2,nextFollowUpDate:"2024-01-20 10:00:00",isDeal:!1},{id:2,customerName:"示例客户2",date:"2024-01-14 09:00:00",type:"face",content:"现场演示产品功能",feedback:"对产品性能非常满意，准备采购",intention:3,nextFollowUpDate:"2024-01-16 14:00:00",isDeal:!0,dealInfo:{products:["drone-a","aerial-photo"],usageFeedback:"产品使用良好，效果符合预期",maintenanceRecords:[{date:"2024-01-10",issue:"图传信号不稳定",solution:"更换了信号模块，恢复正常"}]}}],_.total=20}catch{F.error("加载数据失败")}finally{C.value=!1}};return ce(()=>{k()}),(n,l)=>{const f=u("el-input"),r=u("el-form-item"),h=u("el-option"),I=u("el-select"),R=u("el-date-picker"),c=u("el-button"),A=u("el-form"),G=u("el-card"),i=u("el-table-column"),H=u("el-tag"),B=u("el-rate"),P=u("el-table"),ie=u("el-pagination"),pe=u("el-switch"),J=u("el-divider"),K=u("el-dialog"),b=u("el-descriptions-item"),Q=u("el-descriptions"),me=be("loading");return v(),V("div",ye,[e(G,{class:"filter-card"},{default:t(()=>[e(A,{inline:!0,model:m,class:"search-form"},{default:t(()=>[e(r,{label:"客户名称"},{default:t(()=>[e(f,{modelValue:m.customerName,"onUpdate:modelValue":l[0]||(l[0]=a=>m.customerName=a),placeholder:"请输入客户名称",clearable:""},null,8,["modelValue"])]),_:1}),e(r,{label:"跟进方式"},{default:t(()=>[e(I,{modelValue:m.type,"onUpdate:modelValue":l[1]||(l[1]=a=>m.type=a),placeholder:"请选择",clearable:""},{default:t(()=>[(v(),V(U,null,N($,a=>e(h,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"时间范围"},{default:t(()=>[e(R,{modelValue:m.dateRange,"onUpdate:modelValue":l[2]||(l[2]=a=>m.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(c,{type:"primary",onClick:Y},{default:t(()=>l[20]||(l[20]=[d("搜索")])),_:1}),e(c,{onClick:le},{default:t(()=>l[21]||(l[21]=[d("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(G,{class:"list-card"},{header:t(()=>[D("div",Ve,[l[23]||(l[23]=D("h2",null,"客户跟进记录",-1)),e(c,{type:"primary",onClick:l[3]||(l[3]=a=>L("add"))},{default:t(()=>l[22]||(l[22]=[d("新增跟进")])),_:1})])]),default:t(()=>[ve((v(),ge(P,{data:j.value,style:{width:"100%"}},{default:t(()=>[e(i,{prop:"date",label:"沟通时间",width:"180",sortable:""}),e(i,{prop:"customerName",label:"客户名称",width:"150"}),e(i,{prop:"type",label:"沟通方式",width:"120"},{default:t(({row:a})=>[e(H,{type:O(a.type)},{default:t(()=>[d(g(a.type),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"content",label:"沟通内容","show-overflow-tooltip":""}),e(i,{prop:"feedback",label:"客户反馈","show-overflow-tooltip":""}),e(i,{prop:"intention",label:"意向程度",width:"120"},{default:t(({row:a})=>[e(B,{modelValue:a.intention,"onUpdate:modelValue":p=>a.intention=p,disabled:"",max:3},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(i,{prop:"nextFollowUpDate",label:"下次跟进",width:"180"}),e(i,{label:"操作",width:"180",fixed:"right"},{default:t(({row:a})=>[e(c,{link:"",type:"primary",onClick:p=>L("edit",a)},{default:t(()=>l[24]||(l[24]=[d("编辑")])),_:2},1032,["onClick"]),e(c,{link:"",type:"primary",onClick:p=>oe(a)},{default:t(()=>l[25]||(l[25]=[d("详情")])),_:2},1032,["onClick"]),e(c,{link:"",type:"danger",onClick:p=>re(a)},{default:t(()=>l[26]||(l[26]=[d("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[me,C.value]]),D("div",we,[e(ie,{"current-page":_.currentPage,"onUpdate:currentPage":l[4]||(l[4]=a=>_.currentPage=a),"page-size":_.pageSize,"onUpdate:pageSize":l[5]||(l[5]=a=>_.pageSize=a),"page-sizes":[10,20,50,100],total:_.total,layout:"total, sizes, prev, pager, next",onSizeChange:ae,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1}),e(K,{modelValue:x.value,"onUpdate:modelValue":l[17]||(l[17]=a=>x.value=a),title:T.value==="add"?"新增跟进记录":"编辑跟进记录",width:"60%","destroy-on-close":""},{footer:t(()=>[D("span",Ue,[e(c,{onClick:l[16]||(l[16]=a=>x.value=!1)},{default:t(()=>l[30]||(l[30]=[d("取消")])),_:1}),e(c,{type:"primary",onClick:se,loading:z.value},{default:t(()=>l[31]||(l[31]=[d(" 确定 ")])),_:1},8,["loading"])])]),default:t(()=>[e(A,{ref_key:"formRef",ref:M,model:o,rules:ee,"label-width":"100px"},{default:t(()=>[e(r,{label:"客户名称",prop:"customerName"},{default:t(()=>[e(I,{modelValue:o.customerName,"onUpdate:modelValue":l[6]||(l[6]=a=>o.customerName=a),filterable:"",placeholder:"请选择客户",style:{width:"100%"}},{default:t(()=>[(v(),V(U,null,N(Z,a=>e(h,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"沟通时间",prop:"date"},{default:t(()=>[e(R,{modelValue:o.date,"onUpdate:modelValue":l[7]||(l[7]=a=>o.date=a),type:"datetime",placeholder:"请选择日期时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(r,{label:"沟通方式",prop:"type"},{default:t(()=>[e(I,{modelValue:o.type,"onUpdate:modelValue":l[8]||(l[8]=a=>o.type=a),placeholder:"请选择",style:{width:"100%"}},{default:t(()=>[(v(),V(U,null,N($,a=>e(h,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"沟通内容",prop:"content"},{default:t(()=>[e(f,{modelValue:o.content,"onUpdate:modelValue":l[9]||(l[9]=a=>o.content=a),type:"textarea",rows:4,placeholder:"请输入沟通内容详情"},null,8,["modelValue"])]),_:1}),e(r,{label:"客户反馈",prop:"feedback"},{default:t(()=>[e(f,{modelValue:o.feedback,"onUpdate:modelValue":l[10]||(l[10]=a=>o.feedback=a),type:"textarea",rows:4,placeholder:"请输入客户反馈"},null,8,["modelValue"])]),_:1}),e(r,{label:"意向程度",prop:"intention"},{default:t(()=>[e(B,{modelValue:o.intention,"onUpdate:modelValue":l[11]||(l[11]=a=>o.intention=a),max:3},null,8,["modelValue"])]),_:1}),e(r,{label:"下次跟进",prop:"nextFollowUpDate"},{default:t(()=>[e(R,{modelValue:o.nextFollowUpDate,"onUpdate:modelValue":l[12]||(l[12]=a=>o.nextFollowUpDate=a),type:"datetime",placeholder:"请选择下次跟进时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(r,{label:"是否成交"},{default:t(()=>[e(pe,{modelValue:o.isDeal,"onUpdate:modelValue":l[13]||(l[13]=a=>o.isDeal=a),onChange:ne},null,8,["modelValue"])]),_:1}),o.isDeal?(v(),V(U,{key:0},[e(J,{"content-position":"left"},{default:t(()=>l[27]||(l[27]=[d("成交信息")])),_:1}),e(r,{label:"购买产品",prop:"dealInfo.products"},{default:t(()=>[e(I,{modelValue:o.dealInfo.products,"onUpdate:modelValue":l[14]||(l[14]=a=>o.dealInfo.products=a),multiple:"",filterable:"",placeholder:"请选择购买的产品/服务",style:{width:"100%"}},{default:t(()=>[(v(),V(U,null,N(X,a=>e(h,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"使用反馈",prop:"dealInfo.usageFeedback"},{default:t(()=>[e(f,{modelValue:o.dealInfo.usageFeedback,"onUpdate:modelValue":l[15]||(l[15]=a=>o.dealInfo.usageFeedback=a),type:"textarea",rows:3,placeholder:"请输入产品使用反馈"},null,8,["modelValue"])]),_:1}),e(r,{label:"维修记录",prop:"dealInfo.maintenanceRecords"},{default:t(()=>[e(P,{data:o.dealInfo.maintenanceRecords,border:"",style:{width:"100%"}},{default:t(()=>[e(i,{prop:"date",label:"维修日期",width:"180"},{default:t(({row:a})=>[e(R,{modelValue:a.date,"onUpdate:modelValue":p=>a.date=p,type:"date",placeholder:"选择日期"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(i,{prop:"issue",label:"问题描述"},{default:t(({row:a})=>[e(f,{modelValue:a.issue,"onUpdate:modelValue":p=>a.issue=p,placeholder:"请输入问题描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(i,{prop:"solution",label:"解决方案"},{default:t(({row:a})=>[e(f,{modelValue:a.solution,"onUpdate:modelValue":p=>a.solution=p,placeholder:"请输入解决方案"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(i,{label:"操作",width:"100"},{default:t(({$index:a})=>[e(c,{link:"",type:"danger",onClick:p=>ue(a)},{default:t(()=>l[28]||(l[28]=[d(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),D("div",ke,[e(c,{type:"primary",link:"",onClick:de},{default:t(()=>l[29]||(l[29]=[d(" 添加维修记录 ")])),_:1})])]),_:1})],64)):E("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(K,{modelValue:S.value,"onUpdate:modelValue":l[19]||(l[19]=a=>S.value=a),title:"跟进记录详情",width:"50%"},{default:t(()=>{var a,p;return[e(Q,{column:1,border:""},{default:t(()=>[e(b,{label:"客户名称"},{default:t(()=>[d(g(s.value.customerName),1)]),_:1}),e(b,{label:"沟通时间"},{default:t(()=>[d(g(s.value.date),1)]),_:1}),e(b,{label:"沟通方式"},{default:t(()=>[e(H,{type:O(s.value.type)},{default:t(()=>[d(g(s.value.type),1)]),_:1},8,["type"])]),_:1}),e(b,{label:"沟通内容"},{default:t(()=>[d(g(s.value.content),1)]),_:1}),e(b,{label:"客户反馈"},{default:t(()=>[d(g(s.value.feedback),1)]),_:1}),e(b,{label:"意向程度"},{default:t(()=>[e(B,{modelValue:s.value.intention,"onUpdate:modelValue":l[18]||(l[18]=w=>s.value.intention=w),disabled:"",max:3},null,8,["modelValue"])]),_:1}),e(b,{label:"下次跟进时间"},{default:t(()=>[d(g(s.value.nextFollowUpDate),1)]),_:1})]),_:1}),s.value.isDeal?(v(),V(U,{key:0},[e(J,{"content-position":"left"},{default:t(()=>l[32]||(l[32]=[d("成交信息")])),_:1}),e(Q,{column:1,border:""},{default:t(()=>[e(b,{label:"购买产品"},{default:t(()=>{var w,W;return[d(g((W=(w=s.value.dealInfo)==null?void 0:w.products)==null?void 0:W.join(", ")),1)]}),_:1}),e(b,{label:"使用反馈"},{default:t(()=>{var w;return[d(g((w=s.value.dealInfo)==null?void 0:w.usageFeedback),1)]}),_:1})]),_:1}),(p=(a=s.value.dealInfo)==null?void 0:a.maintenanceRecords)!=null&&p.length?(v(),V("div",De,[l[33]||(l[33]=D("h4",null,"维修记录",-1)),e(P,{data:s.value.dealInfo.maintenanceRecords,border:""},{default:t(()=>[e(i,{prop:"date",label:"维修日期",width:"180"}),e(i,{prop:"issue",label:"问题描述"}),e(i,{prop:"solution",label:"解决方案"})]),_:1},8,["data"])])):E("",!0)],64)):E("",!0)]}),_:1},8,["modelValue"])])}}},he=fe(Ce,[["__scopeId","data-v-7b171c5f"]]);export{he as default};

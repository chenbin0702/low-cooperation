import{_ as pe,r as g,a as P,o as me,c as u,n as ce,d as _,e as V,f as l,w as a,E as w,F as z,p as D,i as s,g as k,q as fe,h as ge,t as c,j as ve,l as G}from"./index-bbf05c48.js";const _e={class:"negotiation-records"},be={class:"card-header"},ye={class:"pagination"},Ve={class:"dialog-footer"},we={key:0,class:"attachments-list"},ke={__name:"NegotiationRecords",setup(xe){const H=[{label:"线下会议",value:"offline"},{label:"视频会议",value:"video"},{label:"电话",value:"phone"},{label:"邮件",value:"email"}],$=[{label:"初步接触",value:"initial"},{label:"深入洽谈",value:"negotiating"},{label:"达成意向",value:"intended"},{label:"签约完成",value:"signed"},{label:"暂停搁置",value:"suspended"}],J=[{label:"示例客户1",value:"customer1"},{label:"示例客户2",value:"customer2"}],x=g(!1),T=g(!1),C=g(!1),R=g(!1),M=g("add"),B=g(null),d=g({}),i=P({customerName:"",status:"",dateRange:[]}),f=P({currentPage:1,pageSize:10,total:0}),n=P({customerName:"",date:"",type:"",topic:"",content:"",status:"",nextStep:"",attachments:[]}),q=g([]),Q={customerName:[{required:!0,message:"请选择客户",trigger:"change"}],date:[{required:!0,message:"请选择洽谈日期",trigger:"change"}],type:[{required:!0,message:"请选择洽谈方式",trigger:"change"}],topic:[{required:!0,message:"请输入洽谈主题",trigger:"blur"}],content:[{required:!0,message:"请输入洽谈内容",trigger:"blur"}],status:[{required:!0,message:"请选择洽谈状态",trigger:"change"}]},E=o=>({offline:"",video:"success",phone:"warning",email:"info"})[o]||"",O=o=>({initial:"info",negotiating:"warning",intended:"success",signed:"success",suspended:"danger"})[o]||"",j=()=>{b()},W=()=>{Object.keys(i).forEach(o=>{i[o]=""}),i.dateRange=[],j()},X=o=>{f.pageSize=o,b()},Z=o=>{f.currentPage=o,b()},F=(o,e=null)=>{M.value=o,C.value=!0,o==="edit"&&e?Object.assign(n,e):(Object.keys(n).forEach(y=>{n[y]=""}),n.attachments=[])},ee=o=>{d.value={...o},R.value=!0},le=o=>{console.log(o)},te=(o,e)=>{console.log(o,e)},ae=o=>G.confirm(`确定移除 ${o.name}？`),oe=o=>{w.success(`开始下载文件：${o.name}`)},ne=async()=>{if(B.value)try{await B.value.validate(),T.value=!0,await new Promise(o=>setTimeout(o,1e3)),w.success(M.value==="add"?"添加成功":"更新成功"),C.value=!1,b()}catch{w.error("表单验证失败，请检查必填项")}finally{T.value=!1}},se=o=>{G.confirm("确定要删除该洽谈记录吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{x.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),w.success("删除成功"),b()}catch{w.error("删除失败")}finally{x.value=!1}})},b=async()=>{x.value=!0;try{await new Promise(o=>setTimeout(o,1e3)),q.value=[{id:1,customerName:"示例客户1",date:"2024-01-15 14:30:00",type:"offline",topic:"项目合作洽谈",content:"讨论了项目具体实施方案和合作模式",status:"negotiating",nextStep:"准备合作协议初稿",attachments:[{name:"会议纪要.docx",size:"156KB"}]},{id:2,customerName:"示例客户2",date:"2024-01-14 09:00:00",type:"video",topic:"商务合作意向讨论",content:"介绍了公司业务范围和优势",status:"initial",nextStep:"安排实地考察",attachments:[]}],f.total=20}catch{w.error("加载数据失败")}finally{x.value=!1}};return me(()=>{b()}),(o,e)=>{const y=u("el-input"),r=u("el-form-item"),h=u("el-option"),S=u("el-select"),Y=u("el-date-picker"),p=u("el-button"),L=u("el-form"),I=u("el-card"),m=u("el-table-column"),N=u("el-tag"),K=u("el-table"),ue=u("el-pagination"),de=u("el-upload"),A=u("el-dialog"),v=u("el-descriptions-item"),re=u("el-descriptions"),ie=ce("loading");return _(),V("div",_e,[l(I,{class:"filter-card"},{default:a(()=>[l(L,{inline:!0,model:i,class:"search-form"},{default:a(()=>[l(r,{label:"客户名称"},{default:a(()=>[l(y,{modelValue:i.customerName,"onUpdate:modelValue":e[0]||(e[0]=t=>i.customerName=t),placeholder:"请输入客户名称",clearable:""},null,8,["modelValue"])]),_:1}),l(r,{label:"洽谈状态"},{default:a(()=>[l(S,{modelValue:i.status,"onUpdate:modelValue":e[1]||(e[1]=t=>i.status=t),placeholder:"请选择",clearable:""},{default:a(()=>[(_(),V(z,null,D($,t=>l(h,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"时间范围"},{default:a(()=>[l(Y,{modelValue:i.dateRange,"onUpdate:modelValue":e[2]||(e[2]=t=>i.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(r,null,{default:a(()=>[l(p,{type:"primary",onClick:j},{default:a(()=>e[16]||(e[16]=[s("搜索")])),_:1}),l(p,{onClick:W},{default:a(()=>e[17]||(e[17]=[s("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(I,{class:"list-card"},{header:a(()=>[k("div",be,[e[19]||(e[19]=k("h2",null,"洽谈记录",-1)),l(p,{type:"primary",onClick:e[3]||(e[3]=t=>F("add"))},{default:a(()=>e[18]||(e[18]=[s("新增记录")])),_:1})])]),default:a(()=>[fe((_(),ge(K,{data:q.value,style:{width:"100%"}},{default:a(()=>[l(m,{prop:"date",label:"洽谈日期",width:"180",sortable:""}),l(m,{prop:"customerName",label:"客户名称",width:"150"}),l(m,{prop:"type",label:"洽谈方式",width:"120"},{default:a(({row:t})=>[l(N,{type:E(t.type)},{default:a(()=>[s(c(t.type),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"topic",label:"洽谈主题","show-overflow-tooltip":""}),l(m,{prop:"status",label:"洽谈状态",width:"120"},{default:a(({row:t})=>[l(N,{type:O(t.status)},{default:a(()=>[s(c(t.status),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"nextStep",label:"下一步计划","show-overflow-tooltip":""}),l(m,{label:"操作",width:"180",fixed:"right"},{default:a(({row:t})=>[l(p,{link:"",type:"primary",onClick:U=>F("edit",t)},{default:a(()=>e[20]||(e[20]=[s("编辑")])),_:2},1032,["onClick"]),l(p,{link:"",type:"primary",onClick:U=>ee(t)},{default:a(()=>e[21]||(e[21]=[s("详情")])),_:2},1032,["onClick"]),l(p,{link:"",type:"danger",onClick:U=>se(t)},{default:a(()=>e[22]||(e[22]=[s("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ie,x.value]]),k("div",ye,[l(ue,{"current-page":f.currentPage,"onUpdate:currentPage":e[4]||(e[4]=t=>f.currentPage=t),"page-size":f.pageSize,"onUpdate:pageSize":e[5]||(e[5]=t=>f.pageSize=t),"page-sizes":[10,20,50,100],total:f.total,layout:"total, sizes, prev, pager, next",onSizeChange:X,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),_:1}),l(A,{modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=t=>C.value=t),title:M.value==="add"?"新增洽谈记录":"编辑洽谈记录",width:"60%","destroy-on-close":""},{footer:a(()=>[k("span",Ve,[l(p,{onClick:e[13]||(e[13]=t=>C.value=!1)},{default:a(()=>e[25]||(e[25]=[s("取消")])),_:1}),l(p,{type:"primary",onClick:ne,loading:T.value},{default:a(()=>e[26]||(e[26]=[s(" 确定 ")])),_:1},8,["loading"])])]),default:a(()=>[l(L,{ref_key:"formRef",ref:B,model:n,rules:Q,"label-width":"100px"},{default:a(()=>[l(r,{label:"客户名称",prop:"customerName"},{default:a(()=>[l(S,{modelValue:n.customerName,"onUpdate:modelValue":e[6]||(e[6]=t=>n.customerName=t),filterable:"",placeholder:"请选择客户",style:{width:"100%"}},{default:a(()=>[(_(),V(z,null,D(J,t=>l(h,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"洽谈日期",prop:"date"},{default:a(()=>[l(Y,{modelValue:n.date,"onUpdate:modelValue":e[7]||(e[7]=t=>n.date=t),type:"datetime",placeholder:"请选择日期时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(r,{label:"洽谈方式",prop:"type"},{default:a(()=>[l(S,{modelValue:n.type,"onUpdate:modelValue":e[8]||(e[8]=t=>n.type=t),placeholder:"请选择",style:{width:"100%"}},{default:a(()=>[(_(),V(z,null,D(H,t=>l(h,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"洽谈主题",prop:"topic"},{default:a(()=>[l(y,{modelValue:n.topic,"onUpdate:modelValue":e[9]||(e[9]=t=>n.topic=t),placeholder:"请输入洽谈主题"},null,8,["modelValue"])]),_:1}),l(r,{label:"洽谈内容",prop:"content"},{default:a(()=>[l(y,{modelValue:n.content,"onUpdate:modelValue":e[10]||(e[10]=t=>n.content=t),type:"textarea",rows:4,placeholder:"请输入洽谈内容详情"},null,8,["modelValue"])]),_:1}),l(r,{label:"洽谈状态",prop:"status"},{default:a(()=>[l(S,{modelValue:n.status,"onUpdate:modelValue":e[11]||(e[11]=t=>n.status=t),placeholder:"请选择",style:{width:"100%"}},{default:a(()=>[(_(),V(z,null,D($,t=>l(h,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"下一步计划",prop:"nextStep"},{default:a(()=>[l(y,{modelValue:n.nextStep,"onUpdate:modelValue":e[12]||(e[12]=t=>n.nextStep=t),type:"textarea",rows:3,placeholder:"请输入下一步工作计划"},null,8,["modelValue"])]),_:1}),l(r,{label:"附件"},{default:a(()=>[l(de,{class:"upload-demo",action:"/api/upload","on-preview":le,"on-remove":te,"before-remove":ae,multiple:"",limit:3},{tip:a(()=>e[24]||(e[24]=[k("div",{class:"el-upload__tip"}," 可上传会议纪要、合作意向书等文件，单个文件不超过10MB ",-1)])),default:a(()=>[l(p,{type:"primary"},{default:a(()=>e[23]||(e[23]=[s("点击上传")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(A,{modelValue:R.value,"onUpdate:modelValue":e[15]||(e[15]=t=>R.value=t),title:"洽谈记录详情",width:"50%"},{default:a(()=>{var t;return[l(re,{column:1,border:""},{default:a(()=>[l(v,{label:"客户名称"},{default:a(()=>[s(c(d.value.customerName),1)]),_:1}),l(v,{label:"洽谈日期"},{default:a(()=>[s(c(d.value.date),1)]),_:1}),l(v,{label:"洽谈方式"},{default:a(()=>[l(N,{type:E(d.value.type)},{default:a(()=>[s(c(d.value.type),1)]),_:1},8,["type"])]),_:1}),l(v,{label:"洽谈主题"},{default:a(()=>[s(c(d.value.topic),1)]),_:1}),l(v,{label:"洽谈内容"},{default:a(()=>[s(c(d.value.content),1)]),_:1}),l(v,{label:"洽谈状态"},{default:a(()=>[l(N,{type:O(d.value.status)},{default:a(()=>[s(c(d.value.status),1)]),_:1},8,["type"])]),_:1}),l(v,{label:"下一步计划"},{default:a(()=>[s(c(d.value.nextStep),1)]),_:1})]),_:1}),(t=d.value.attachments)!=null&&t.length?(_(),V("div",we,[e[28]||(e[28]=k("h4",null,"附件列表",-1)),l(K,{data:d.value.attachments,border:""},{default:a(()=>[l(m,{prop:"name",label:"文件名"}),l(m,{prop:"size",label:"大小",width:"120"}),l(m,{label:"操作",width:"120"},{default:a(({row:U})=>[l(p,{link:"",type:"primary",onClick:Ce=>oe(U)},{default:a(()=>e[27]||(e[27]=[s(" 下载 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):ve("",!0)]}),_:1},8,["modelValue"])])}}},Se=pe(ke,[["__scopeId","data-v-39969b33"]]);export{Se as default};

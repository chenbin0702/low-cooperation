import{_ as oe,u as ue,r as y,a as D,o as ie,c as u,n as se,d as S,e as re,f as t,w as a,E as q,i as o,g as d,q as de,h as O,t as s,x as z,j as pe}from"./index-bbf05c48.js";const me={class:"inventory-query"},ce={class:"card-header"},ye={class:"header-actions"},fe={class:"pagination"},_e={class:"dialog-footer"},ve={class:"detail-section"},be={__name:"InventoryQuery",setup(ge){ue();const w=y(!1),k=y(!1),h=y(null),C=y(!1),v=y({}),Q=y(!1),p=y(null),P=y([]),c=D({name:"",type:"",stockStatus:""}),f=D({currentPage:1,pageSize:10,total:0}),M=y([]),m=D({quantity:1,expectedDate:"",reason:"",remark:""}),$={quantity:[{required:!0,message:"请输入申请数量",trigger:"blur"},{type:"number",min:1,message:"申请数量必须大于0",trigger:"blur"}],expectedDate:[{required:!0,message:"请选择期望到货日期",trigger:"change"}],reason:[{required:!0,message:"请输入补货原因",trigger:"blur"}]},R=n=>n.quantity<=n.minQuantity?"stock-insufficient":n.quantity<=n.minQuantity*1.2?"stock-low":n.quantity>=n.maxQuantity*.8?"stock-sufficient":"stock-normal",T=()=>{x()},j=()=>{Object.keys(c).forEach(n=>{c[n]=""}),T()},A=n=>{f.pageSize=n,x()},H=n=>{f.currentPage=n,x()},L=()=>{q.success("库存数据导出成功")},G=n=>n.getTime()<Date.now(),J=n=>{v.value={...n},m.quantity=Math.max(n.minQuantity-n.quantity,1),k.value=!0},K=async()=>{if(h.value)try{await h.value.validate(),C.value=!0,await new Promise(n=>setTimeout(n,1e3)),q.success("补货申请提交成功"),k.value=!1,x()}catch{q.error("表单验证失败，请检查必填项")}finally{C.value=!1}},W=async n=>{p.value=n,P.value=[{type:"in",quantity:10,operator:"张三",time:"2024-01-15 10:00:00",remark:"采购入库"},{type:"out",quantity:5,operator:"李四",time:"2024-01-14 15:30:00",remark:"销售出库"},{type:"check",quantity:15,operator:"王五",time:"2024-01-13 09:00:00",remark:"库存盘点"}],Q.value=!0},x=async()=>{w.value=!0;try{await new Promise(n=>setTimeout(n,1e3)),M.value=[{code:"P001",name:"无人机A型",type:"无人机",quantity:5,minQuantity:10,maxQuantity:50,location:"A区-01-01",lastUpdate:"2024-01-15 14:30:00"},{code:"P002",name:"专业航拍镜头",type:"配件",quantity:20,minQuantity:15,maxQuantity:100,location:"B区-02-03",lastUpdate:"2024-01-15 10:00:00"}],f.total=20}catch{q.error("加载数据失败")}finally{w.value=!1}};ie(()=>{x()});const X=n=>({in:"success",out:"danger",check:"info"})[n]||"info",Y=n=>({in:"入库",out:"出库",check:"盘点"})[n]||n;return(n,l)=>{const V=u("el-input"),r=u("el-form-item"),b=u("el-option"),B=u("el-select"),g=u("el-button"),I=u("el-form"),E=u("el-card"),i=u("el-table-column"),U=u("el-tag"),F=u("el-table"),Z=u("el-pagination"),ee=u("el-input-number"),te=u("el-date-picker"),N=u("el-dialog"),_=u("el-descriptions-item"),le=u("el-descriptions"),ae=se("loading");return S(),re("div",me,[t(E,{class:"filter-card"},{default:a(()=>[t(I,{inline:!0,model:c,class:"search-form"},{default:a(()=>[t(r,{label:"商品名称"},{default:a(()=>[t(V,{modelValue:c.name,"onUpdate:modelValue":l[0]||(l[0]=e=>c.name=e),placeholder:"请输入商品名称",clearable:""},null,8,["modelValue"])]),_:1}),t(r,{label:"商品类型"},{default:a(()=>[t(B,{modelValue:c.type,"onUpdate:modelValue":l[1]||(l[1]=e=>c.type=e),placeholder:"请选择",clearable:""},{default:a(()=>[t(b,{label:"无人机",value:"drone"}),t(b,{label:"配件",value:"parts"}),t(b,{label:"耗材",value:"consumables"})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"库存状态"},{default:a(()=>[t(B,{modelValue:c.stockStatus,"onUpdate:modelValue":l[2]||(l[2]=e=>c.stockStatus=e),placeholder:"请选择",clearable:""},{default:a(()=>[t(b,{label:"充足",value:"sufficient"}),t(b,{label:"正常",value:"normal"}),t(b,{label:"偏低",value:"low"}),t(b,{label:"不足",value:"insufficient"})]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(g,{type:"primary",onClick:T},{default:a(()=>l[15]||(l[15]=[o("搜索")])),_:1}),t(g,{onClick:j},{default:a(()=>l[16]||(l[16]=[o("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(E,{class:"list-card"},{header:a(()=>[d("div",ce,[l[18]||(l[18]=d("h2",null,"库存列表",-1)),d("div",ye,[t(g,{type:"primary",onClick:L},{default:a(()=>l[17]||(l[17]=[o("导出库存")])),_:1})])])]),default:a(()=>[de((S(),O(F,{data:M.value,style:{width:"100%"}},{default:a(()=>[t(i,{prop:"code",label:"商品编码",width:"120"}),t(i,{prop:"name",label:"商品名称","min-width":"180","show-overflow-tooltip":""}),t(i,{prop:"type",label:"商品类型",width:"120"},{default:a(({row:e})=>[t(U,null,{default:a(()=>[o(s(e.type),1)]),_:2},1024)]),_:1}),t(i,{prop:"quantity",label:"当前库存",width:"120"},{default:a(({row:e})=>[d("span",{class:z(R(e))},s(e.quantity),3)]),_:1}),t(i,{prop:"minQuantity",label:"最低库存",width:"120"}),t(i,{prop:"maxQuantity",label:"最高库存",width:"120"}),t(i,{prop:"location",label:"库存位置",width:"150","show-overflow-tooltip":""}),t(i,{prop:"lastUpdate",label:"最后更新",width:"180",sortable:""}),t(i,{label:"操作",width:"180",fixed:"right"},{default:a(({row:e})=>[e.quantity<e.minQuantity?(S(),O(g,{key:0,link:"",type:"warning",onClick:ne=>J(e)},{default:a(()=>l[19]||(l[19]=[o(" 申请补货 ")])),_:2},1032,["onClick"])):pe("",!0),t(g,{link:"",type:"primary",onClick:ne=>W(e)},{default:a(()=>l[20]||(l[20]=[o(" 详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,w.value]]),d("div",fe,[t(Z,{"current-page":f.currentPage,"onUpdate:currentPage":l[3]||(l[3]=e=>f.currentPage=e),"page-size":f.pageSize,"onUpdate:pageSize":l[4]||(l[4]=e=>f.pageSize=e),"page-sizes":[10,20,50,100],total:f.total,layout:"total, sizes, prev, pager, next",onSizeChange:A,onCurrentChange:H},null,8,["current-page","page-size","total"])])]),_:1}),t(N,{modelValue:k.value,"onUpdate:modelValue":l[13]||(l[13]=e=>k.value=e),title:"补货申请",width:"600px","destroy-on-close":""},{footer:a(()=>[d("span",_e,[t(g,{onClick:l[12]||(l[12]=e=>k.value=!1)},{default:a(()=>l[23]||(l[23]=[o("取消")])),_:1}),t(g,{type:"primary",onClick:K,loading:C.value},{default:a(()=>l[24]||(l[24]=[o(" 提交申请 ")])),_:1},8,["loading"])])]),default:a(()=>[t(I,{ref_key:"replenishmentFormRef",ref:h,model:m,rules:$,"label-width":"100px"},{default:a(()=>[t(r,{label:"商品名称"},{default:a(()=>[t(V,{modelValue:v.value.name,"onUpdate:modelValue":l[5]||(l[5]=e=>v.value.name=e),disabled:""},null,8,["modelValue"])]),_:1}),t(r,{label:"当前库存"},{default:a(()=>[t(V,{modelValue:v.value.quantity,"onUpdate:modelValue":l[6]||(l[6]=e=>v.value.quantity=e),disabled:""},{append:a(()=>l[21]||(l[21]=[o("件")])),_:1},8,["modelValue"])]),_:1}),t(r,{label:"最低库存"},{default:a(()=>[t(V,{modelValue:v.value.minQuantity,"onUpdate:modelValue":l[7]||(l[7]=e=>v.value.minQuantity=e),disabled:""},{append:a(()=>l[22]||(l[22]=[o("件")])),_:1},8,["modelValue"])]),_:1}),t(r,{label:"申请数量",prop:"quantity"},{default:a(()=>[t(ee,{modelValue:m.quantity,"onUpdate:modelValue":l[8]||(l[8]=e=>m.quantity=e),min:1,precision:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(r,{label:"期望到货日期",prop:"expectedDate"},{default:a(()=>[t(te,{modelValue:m.expectedDate,"onUpdate:modelValue":l[9]||(l[9]=e=>m.expectedDate=e),type:"date",placeholder:"选择日期","disabled-date":G,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(r,{label:"补货原因",prop:"reason"},{default:a(()=>[t(V,{modelValue:m.reason,"onUpdate:modelValue":l[10]||(l[10]=e=>m.reason=e),type:"textarea",rows:3,placeholder:"请说明补货原因"},null,8,["modelValue"])]),_:1}),t(r,{label:"备注说明",prop:"remark"},{default:a(()=>[t(V,{modelValue:m.remark,"onUpdate:modelValue":l[11]||(l[11]=e=>m.remark=e),type:"textarea",rows:3,placeholder:"请输入备注说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(N,{modelValue:Q.value,"onUpdate:modelValue":l[14]||(l[14]=e=>Q.value=e),title:"库存详情",width:"60%"},{default:a(()=>[t(le,{column:2,border:""},{default:a(()=>[t(_,{label:"商品编码"},{default:a(()=>{var e;return[o(s((e=p.value)==null?void 0:e.code),1)]}),_:1}),t(_,{label:"商品名称"},{default:a(()=>{var e;return[o(s((e=p.value)==null?void 0:e.name),1)]}),_:1}),t(_,{label:"商品类型"},{default:a(()=>[t(U,null,{default:a(()=>{var e;return[o(s((e=p.value)==null?void 0:e.type),1)]}),_:1})]),_:1}),t(_,{label:"当前库存"},{default:a(()=>{var e;return[d("span",{class:z(R(p.value))},s((e=p.value)==null?void 0:e.quantity),3)]}),_:1}),t(_,{label:"最低库存"},{default:a(()=>{var e;return[o(s((e=p.value)==null?void 0:e.minQuantity),1)]}),_:1}),t(_,{label:"最高库存"},{default:a(()=>{var e;return[o(s((e=p.value)==null?void 0:e.maxQuantity),1)]}),_:1}),t(_,{label:"库存位置"},{default:a(()=>{var e;return[o(s((e=p.value)==null?void 0:e.location),1)]}),_:1}),t(_,{label:"最后更新"},{default:a(()=>{var e;return[o(s((e=p.value)==null?void 0:e.lastUpdate),1)]}),_:1})]),_:1}),d("div",ve,[l[25]||(l[25]=d("div",{class:"section-header"},[d("h3",null,"出入库记录")],-1)),t(F,{data:P.value,style:{width:"100%"}},{default:a(()=>[t(i,{label:"类型",width:"100"},{default:a(({row:e})=>[t(U,{type:X(e.type)},{default:a(()=>[o(s(Y(e.type)),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"quantity",label:"数量",width:"100"},{default:a(({row:e})=>[d("span",{class:z({"text-red":e.type==="out","text-green":e.type==="in"})},s(e.type==="out"?"-":"+")+s(e.quantity),3)]),_:1}),t(i,{prop:"operator",label:"操作人",width:"120"}),t(i,{prop:"time",label:"操作时间",width:"180"}),t(i,{prop:"remark",label:"备注","show-overflow-tooltip":""})]),_:1},8,["data"])])]),_:1},8,["modelValue"])])}}},ke=oe(be,[["__scopeId","data-v-c6027703"]]);export{ke as default};
